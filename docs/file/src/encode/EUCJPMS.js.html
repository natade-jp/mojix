<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/encode/EUCJPMS.js | mojix</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Moji / Kanji / Unicode analysis utilities (work in progress)"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="mojix"><meta property="twitter:description" content="Moji / Kanji / Unicode analysis utilities (work in progress)"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/natade-jp/mojix"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mojix.js~Mojix.html">Mojix</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#encode">encode</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MenKuTen">MenKuTen</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools">tools</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MojiData">MojiData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MojiEncodeData">MojiEncodeData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MojiTypeData">MojiTypeData</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/encode/EUCJPMS.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&#xFEFF;/**
 * The script is part of Mojix.
 *
 * AUTHOR:
 *  natade (http://twitter.com/natadea)
 *
 * LICENSE:
 *  The MIT license https://opensource.org/licenses/MIT
 */

import SJIS from &quot;./SJIS.js&quot;;
import CP932 from &quot;./CP932.js&quot;;

/**
 * eucJP-ms &#x306E;&#x5909;&#x63DB;&#x30DE;&#x30C3;&#x30D7;&#x4F5C;&#x6210;&#x7528;&#x30AF;&#x30E9;&#x30B9;
 * @ignore
 */
class EUCJPMSMAP {
	/**
	 * &#x5909;&#x63DB;&#x30DE;&#x30C3;&#x30D7;&#x3092;&#x521D;&#x671F;&#x5316;
	 */
	static init() {
		if (EUCJPMSMAP.is_initmap) {
			return;
		}
		EUCJPMSMAP.is_initmap = true;

		/* eslint-disable max-len */
		/* eslint-disable object-property-newline */
		/**
		 * &#x5909;&#x63DB;&#x30DE;&#x30C3;&#x30D7;
		 * CP932&#x306E;IBM&#x62E1;&#x5F35;&#x6587;&#x5B57;&#x306E;&#x4E00;&#x90E8;&#x306F;&#x3001;eucJP-ms&#x306E;G3&#x306E;83&#x533A;&#x304B;&#x3089;84&#x533A;&#x306B;&#x914D;&#x5217;&#x3055;&#x308C;&#x3066;&#x3044;&#x308B;&#x3002;
		 * @type {Record&lt;number, number&gt;}
		 */
		// prettier-ignore
		const eucjpms_to_cp932_map = {
			0xF3F3: 0xFA40, 0xF3F4: 0xFA41, 0xF3F5: 0xFA42, 0xF3F6: 0xFA43, 0xF3F7: 0xFA44,
			0xF3F8: 0xFA45, 0xF3F9: 0xFA46, 0xF3FA: 0xFA47, 0xF3FB: 0xFA48, 0xF3FC: 0xFA49, 0xF3FD: 0x8754, 0xF3FE: 0x8755,
			0xF4A1: 0x8756, 0xF4A2: 0x8757, 0xF4A3: 0x8758, 0xF4A4: 0x8759, 0xF4A5: 0x875A, 0xF4A6: 0x875B, 0xF4A7: 0x875C,
			0xF4A8: 0x875D, 0xF4A9: 0xFA56, 0xF4AA: 0xFA57, 0xF4AB: 0x878A, 0xF4AC: 0x8782, 0xF4AD: 0x8784, 0xF4AE: 0xFA62, 0xF4AF: 0xFA6A,
			0xF4B0: 0xFA7C, 0xF4B1: 0xFA83, 0xF4B2: 0xFA8A, 0xF4B3: 0xFA8B, 0xF4B4: 0xFA90, 0xF4B5: 0xFA92, 0xF4B6: 0xFA96, 0xF4B7: 0xFA9B,
			0xF4B8: 0xFA9C, 0xF4B9: 0xFA9D, 0xF4BA: 0xFAAA, 0xF4BB: 0xFAAE, 0xF4BC: 0xFAB0, 0xF4BD: 0xFAB1, 0xF4BE: 0xFABA, 0xF4BF: 0xFABD,
			0xF4C0: 0xFAC1, 0xF4C1: 0xFACD, 0xF4C2: 0xFAD0, 0xF4C3: 0xFAD5, 0xF4C4: 0xFAD8, 0xF4C5: 0xFAE0, 0xF4C6: 0xFAE5, 0xF4C7: 0xFAE8,
			0xF4C8: 0xFAEA, 0xF4C9: 0xFAEE, 0xF4CA: 0xFAF2, 0xF4CB: 0xFB43, 0xF4CC: 0xFB44, 0xF4CD: 0xFB50, 0xF4CE: 0xFB58, 0xF4CF: 0xFB5E,
			0xF4D0: 0xFB6E, 0xF4D1: 0xFB70, 0xF4D2: 0xFB72, 0xF4D3: 0xFB75, 0xF4D4: 0xFB7C, 0xF4D5: 0xFB7D, 0xF4D6: 0xFB7E, 0xF4D7: 0xFB80,
			0xF4D8: 0xFB82, 0xF4D9: 0xFB85, 0xF4DA: 0xFB86, 0xF4DB: 0xFB89, 0xF4DC: 0xFB8D, 0xF4DD: 0xFB8E, 0xF4DE: 0xFB92, 0xF4DF: 0xFB94,
			0xF4E0: 0xFB9D, 0xF4E1: 0xFB9E, 0xF4E2: 0xFB9F, 0xF4E3: 0xFBA0, 0xF4E4: 0xFBA1, 0xF4E5: 0xFBA9, 0xF4E6: 0xFBAC, 0xF4E7: 0xFBAE,
			0xF4E8: 0xFBB0, 0xF4E9: 0xFBB1, 0xF4EA: 0xFBB3, 0xF4EB: 0xFBB4, 0xF4EC: 0xFBB6, 0xF4ED: 0xFBB7, 0xF4EE: 0xFBB8, 0xF4EF: 0xFBD3,
			0xF4F0: 0xFBDA, 0xF4F1: 0xFBE8, 0xF4F2: 0xFBE9, 0xF4F3: 0xFBEA, 0xF4F4: 0xFBEE, 0xF4F5: 0xFBF0, 0xF4F6: 0xFBF2, 0xF4F7: 0xFBF6,
			0xF4F8: 0xFBF7, 0xF4F9: 0xFBF9, 0xF4FA: 0xFBFA, 0xF4FB: 0xFBFC, 0xF4FC: 0xFC42, 0xF4FD: 0xFC49, 0xF4FE: 0xFC4B
		};
		/* eslint-enable object-property-newline */
		/* eslint-enable max-len */

		/**
		 * @type {Record&lt;number, number&gt;}
		 */
		const cp932_to_eucjpms_map = {};

		for (const key in eucjpms_to_cp932_map) {
			const x = eucjpms_to_cp932_map[key];
			cp932_to_eucjpms_map[x] = parseInt(key, 10);
		}

		EUCJPMSMAP.cp932_to_eucjpms_map = cp932_to_eucjpms_map;
		EUCJPMSMAP.eucjpms_to_cp932_map = eucjpms_to_cp932_map;
	}

	/**
	 * @returns {Record&lt;number, number&gt;}
	 */
	static CP932_TO_EUCJPMS() {
		EUCJPMSMAP.init();
		return EUCJPMSMAP.cp932_to_eucjpms_map;
	}

	/**
	 * @returns {Record&lt;number, number&gt;}
	 */
	static EUCJPMS_TO_CP932() {
		EUCJPMSMAP.init();
		return EUCJPMSMAP.eucjpms_to_cp932_map;
	}
}

/**
 * &#x5909;&#x63DB;&#x30DE;&#x30C3;&#x30D7;&#x3092;&#x521D;&#x671F;&#x5316;&#x3057;&#x305F;&#x304B;&#x3069;&#x3046;&#x304B;
 * @type {boolean}
 */
EUCJPMSMAP.is_initmap = false;

/**
 * &#x5909;&#x63DB;&#x7528;&#x30DE;&#x30C3;&#x30D7;
 * @type {Record&lt;number, number&gt;}
 */
EUCJPMSMAP.cp932_to_eucjpms_map = null;

/**
 * &#x5909;&#x63DB;&#x7528;&#x30DE;&#x30C3;&#x30D7;
 * @type {Record&lt;number, number&gt;}
 */
EUCJPMSMAP.eucjpms_to_cp932_map = null;

/**
 * eucJP-ms &#x3092;&#x6271;&#x3046;&#x30AF;&#x30E9;&#x30B9;
 * @ignore
 */
export default class EUCJPMS {
	/**
	 * &#x6587;&#x5B57;&#x5217;&#x3092; eucJP-ms &#x306E;&#x30D0;&#x30A4;&#x30CA;&#x30EA;&#x914D;&#x5217;&#x306B;&#x5909;&#x63DB;&#x3002;&#x5909;&#x63DB;&#x3067;&#x304D;&#x306A;&#x3044;&#x6587;&#x5B57;&#x306F; &quot;?&quot; &#x306B;&#x5909;&#x63DB;&#x3055;&#x308C;&#x308B;&#x3002;
	 * - &#x65E5;&#x672C;&#x8A9E;&#x6587;&#x5B57;&#x306F;2&#x30D0;&#x30A4;&#x30C8;&#x3068;&#x3057;&#x3066;&#x3001;&#x914D;&#x5217;&#x3082;2&#x3064;&#x5206;&#x3001;&#x4F7F;&#x7528;&#x3057;&#x307E;&#x3059;&#x3002;
	 * @param {string} text - &#x5909;&#x63DB;&#x3057;&#x305F;&#x3044;&#x30C6;&#x30AD;&#x30B9;&#x30C8;
	 * @returns {number[]} eucJP-ms &#x306E;&#x30C7;&#x30FC;&#x30BF;&#x304C;&#x5165;&#x3063;&#x305F;&#x30D0;&#x30A4;&#x30CA;&#x30EA;&#x914D;&#x5217;
	 */
	static toEUCJPMSBinary(text) {
		const sjis_array = CP932.toCP932Array(text);
		const bin = [];
		const map = EUCJPMSMAP.CP932_TO_EUCJPMS();
		// prettier-ignore
		const SS2 = 0x8E; // C1&#x5236;&#x5FA1;&#x6587;&#x5B57; &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8;2
		// prettier-ignore
		const SS3 = 0x8F; // C1&#x5236;&#x5FA1;&#x6587;&#x5B57; &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8;3
		for (let i = 0; i &lt; sjis_array.length; i++) {
			const code = sjis_array[i];
			const kuten = SJIS.toKuTenFromSJISCode(code);
			// prettier-ignore
			if (code &lt; 0x80) {
				// G0 ASCII
				bin.push(code);
				// prettier-ignore
			} else if (code &lt; 0xE0) {
				// G2 &#x534A;&#x89D2;&#x30AB;&#x30BF;&#x30AB;&#x30CA;
				bin.push(SS2);
				bin.push(code);
			} else {
				const eucjpms_code = map[code];
				if (!eucjpms_code) {
					// G1
					// prettier-ignore
					bin.push(kuten.ku + 0xA0);
					// prettier-ignore
					bin.push(kuten.ten + 0xA0);
				} else {
					// &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8; SS3 &#x3067; G3 &#x3092;&#x547C;&#x3073;&#x51FA;&#x3059;&#x3002;
					// G3 &#x306F;&#x3001;eucJP-ms &#x306E;&#x5834;&#x5408; IBM&#x62E1;&#x5F35;&#x6587;&#x5B57; &#x3092;&#x8868;&#x3059;&#x3002;
					bin.push(SS3);
					bin.push(eucjpms_code &gt;&gt; 8);
					bin.push(eucjpms_code &amp; 0xFF);
				}
			}
		}
		return bin;
	}

	/**
	 * eucJP-ms &#x306E;&#x914D;&#x5217;&#x304B;&#x3089;&#x6587;&#x5B57;&#x5217;&#x306B;&#x5909;&#x63DB;
	 * @param {number[]} eucjp - &#x5909;&#x63DB;&#x3057;&#x305F;&#x3044;&#x30C6;&#x30AD;&#x30B9;&#x30C8;
	 * @returns {string} &#x5909;&#x63DB;&#x5F8C;&#x306E;&#x30C6;&#x30AD;&#x30B9;&#x30C8;
	 */
	static fromEUCJPMSBinary(eucjp) {
		const sjis_array = [];
		const ng = &quot;?&quot;.charCodeAt(0);
		const map = EUCJPMSMAP.EUCJPMS_TO_CP932();
		// prettier-ignore
		const SS2 = 0x8E; // C1&#x5236;&#x5FA1;&#x6587;&#x5B57; &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8;2
		// prettier-ignore
		const SS3 = 0x8F; // C1&#x5236;&#x5FA1;&#x6587;&#x5B57; &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8;3
		for (let i = 0; i &lt; eucjp.length; i++) {
			let x1, x2;
			x1 = eucjp[i];
			// ASCII
			// prettier-ignore
			if (x1 &lt; 0x80) {
				sjis_array.push(x1);
				continue;
			}
			if (i &gt;= eucjp.length - 1) {
				// &#x6587;&#x5B57;&#x304C;&#x8DB3;&#x308A;&#x306A;&#x3044;
				break;
			}
			{
				if (x1 === SS3) {
				// 3&#x30D0;&#x30A4;&#x30C8;&#x8AAD;&#x307F;&#x8FBC;&#x307F;(G3)
					if (i &gt;= eucjp.length - 2) {
						// &#x6587;&#x5B57;&#x304C;&#x8DB3;&#x308A;&#x306A;&#x3044;
						break;
					}
					x1 = eucjp[i + 1];
					x2 = eucjp[i + 2];
					// &#x30B7;&#x30F3;&#x30B0;&#x30EB;&#x30B7;&#x30D5;&#x30C8; SS3 &#x3067; G3 &#x3092;&#x547C;&#x3073;&#x51FA;&#x3059;&#x3002;
					// G3 &#x306F;&#x3001;eucJP-ms &#x306E;&#x5834;&#x5408; IBM&#x62E1;&#x5F35;&#x6587;&#x5B57; &#x3092;&#x8868;&#x3059;&#x3002;
					const nec_code = map[(x1 &lt;&lt; 8) | x2];
					if (nec_code) {
						sjis_array.push(nec_code);
					} else {
						sjis_array.push(ng);
					}
					i += 2;
					continue;
				} else {
					// 2&#x30D0;&#x30A4;&#x30C8;&#x8AAD;&#x307F;&#x8FBC;&#x307F;
					x2 = eucjp[i + 1];
					i += 1;
				}
			}
			// &#x534A;&#x89D2;&#x30AB;&#x30BF;&#x30AB;&#x30CA;
			if (x1 === SS2) {
				sjis_array.push(x2);
				continue;
			}

			// &#x65E5;&#x672C;&#x8A9E;
			// prettier-ignore
			if (0xA1 &lt;= x1 &amp;&amp; x1 &lt;= 0xFE &amp;&amp; 0xA1 &lt;= x2 &amp;&amp; x2 &lt;= 0xFE) {
				// prettier-ignore
				const kuten = {
					ku: x1 - 0xA0,
					ten: x2 - 0xA0
				};
				sjis_array.push(SJIS.toSJISCodeFromKuTen(kuten));
			} else {
				sjis_array.push(ng);
			}
		}
		return CP932.fromCP932Array(sjis_array);
	}
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
